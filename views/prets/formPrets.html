<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Ajouter un Prêt</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 min-h-screen">
    <div class="max-w-xl mx-auto mt-10 p-6 bg-white rounded shadow">
        <h1 class="text-2xl font-bold mb-6 text-center">Ajouter un Prêt</h1>
        <form id="pretForm" class="space-y-4">
            <div>
                <label for="id_types_pret" class="block mb-1 font-medium">Type de prêt</label>
                <select id="id_types_pret" name="id_types_pret" class="w-full border border-gray-300 rounded px-3 py-2"
                    required></select>
            </div>
            <div>
                <label for="id_clients" class="block mb-1 font-medium">Client</label>
                <select id="id_clients" name="id_clients" class="w-full border border-gray-300 rounded px-3 py-2"
                    required></select>
            </div>
            <div>
                <label for="montant_prets" class="block mb-1 font-medium">Montant</label>
                <input type="number" step="0.01" class="w-full border border-gray-300 rounded px-3 py-2"
                    id="montant_prets" name="montant_prets" required>
            </div>
            <div>
                <label for="date_debut" class="block mb-1 font-medium">Date de début</label>
                <input type="date" class="w-full border border-gray-300 rounded px-3 py-2" id="date_debut"
                    name="date_debut" required>
            </div>
            <div>
                <label for="duree_en_mois" class="block mb-1 font-medium">Durée (mois)</label>
                <input type="number" class="w-full border border-gray-300 rounded px-3 py-2" id="duree_en_mois"
                    name="duree_en_mois" required>
            </div>
            <div>
                <label for="pourcentage_assurance" class="block mb-1 font-medium">Pourcentage assurance (%)</label>
                <input type="number" step="0.01" class="w-full border border-gray-300 rounded px-3 py-2"
                    id="pourcentage_assurance" name="pourcentage_assurance">
            </div>
            <div>
                <label for="delai_premier_remboursement" class="block mb-1 font-medium">Délai avant 1er remboursement
                    (mois)</label>
                <input type="number" class="w-full border border-gray-300 rounded px-3 py-2"
                    id="delai_premier_remboursement" name="delai_premier_remboursement">
            </div>
            <div class="flex gap-2">
                <button type="submit"
                    class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded transition">Ajouter</button>
                <a href="listePrets.html"
                    class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-6 rounded transition">Retour
                    à la liste</a>
            </div>
        </form>
        <div id="message" class="mt-4"></div>
    </div>
    <script src="../../config.js"></script>
    <script>
        // Remplir la liste des types de prêt
        fetch(`${API_BASE}/typespret`)
            .then(res => res.json())
            .then(data => {
                const select = document.getElementById('id_types_pret');
                data.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type.id_types_pret;
                    option.textContent = type.nom_type_pret;
                    select.appendChild(option);
                });
            });
        // Remplir la liste des clients
        fetch(`${API_BASE}/clients`)
            .then(res => res.json())
            .then(data => {
                const select = document.getElementById('id_clients');
                data.forEach(client => {
                    const option = document.createElement('option');
                    option.value = client.id_clients;
                    option.textContent = client.nom_clients + ' ' + client.prenom_clients;
                    select.appendChild(option);
                });
            });
        document.getElementById('pretForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const data = {
                id_types_pret: document.getElementById('id_types_pret').value,
                id_clients: document.getElementById('id_clients').value,
                montant_prets: document.getElementById('montant_prets').value,
                date_debut: document.getElementById('date_debut').value,
                duree_en_mois: document.getElementById('duree_en_mois').value,
                pourcentage_assurance: document.getElementById('pourcentage_assurance').value || null,
                delai_premier_remboursement: document.getElementById('delai_premier_remboursement').value || null
            };
            fetch(`${API_BASE}/prets`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
                .then(res => res.json())
                .then(res => {
                    document.getElementById('message').innerHTML = '<div class="bg-green-100 text-green-800 px-4 py-2 rounded">' + res.message + '</div>';
                    document.getElementById('pretForm').reset();
                })
                .catch(() => {
                    document.getElementById('message').innerHTML = '<div class="bg-red-100 text-red-800 px-4 py-2 rounded">Erreur lors de l\'ajout du prêt.</div>';
                });
        });
    </script>
</body>

</html>